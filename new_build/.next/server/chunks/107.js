"use strict";exports.id=107,exports.ids=[107],exports.modules={51023:(e,t,a)=>{a.d(t,{Z:()=>s});var l=a(5492);let s={EXP_DMG_MOD:.1,EXP_TIME_MOD:.05,SYNERGY_MOD_STEP:.25,EXP_TOKEN_MOD:.05,SOUL_CLOVER_STEP:.25,calculatePetBaseDamage:function(e,t){let a=t||e?.Rank,l=e?.BaseDungeonDamage*(1+.05*a);return Number(l)},calculateBestHours:function(e,t,a,l){let s;a?.residueToken&&a.residueToken;let n=a.data.ExpeditionTokenBonuses;t||(t=[1,2,3,4,5,6,7,8,9,10,11,12]),s||(s=a?.clover?a.clover:0),l||(l=1);let i=this.calculateGroupScore(e),o=i.tokenMult*Math.pow(1+this.SOUL_CLOVER_STEP,s)*n*l,r=[];for(let e=0;e<t.length;e++){let a=t[e],l=o*a,s=Math.floor(l),n=s/l,i=l-s,u={wastedHR:i/a,tokenHR:o,wasted:i,hours:a,totalTokens:l,floored:s,effeciency:n};r.push(u)}return r},calculateGroupScore:function(e,t){let a=0,l=0,s=0,n=0,i=0,o=0,r=0,u=0,m=0,c=0,h=0,p=0,g={},D=0;e.forEach(e=>{a+=this.calculatePetBaseDamage(e,t),D+=this.calculatePetBaseDamage(e,0),e.BonusList.some(e=>1013===e.ID)&&l++,e.BonusList.some(e=>1010===e.ID)&&o++,e.BonusList.some(e=>1011===e.ID)&&r++,e.BonusList.some(e=>1014===e.ID)&&m++,e.BonusList.some(e=>1012===e.ID)&&s++,e.BonusList.some(e=>1015===e.ID)&&u++,e.BonusList.some(e=>1016===e.ID)&&c++,g[e.Type]?g[e.Type]++:g[e.Type]=1,e.ID&&(n+=this.SYNERGY_MOD_STEP)}),i=a;let[d,I]=Object.values(g);return d>0&&I>0&&(n+=this.SYNERGY_MOD_STEP),d>1&&I>1&&(n+=this.SYNERGY_MOD_STEP),a*=1+l*this.EXP_DMG_MOD,D*=1+l*this.EXP_DMG_MOD,a*=1+s*this.EXP_TIME_MOD,D*=1+s*this.EXP_TIME_MOD,a*=n,D*=n,p=c*this.EXP_TOKEN_MOD,h=n+n*p,{groupScore:a,baseGroupScore:i,groupScoreMax:D,dmgCount:l,timeCount:s,synergyBonus:n,cardPowerCount:o,expRewardCount:r,cardXpCount:m,rpRewardCount:u,tokenRewardCount:c,tokenModif:p,tokenMult:h}},getBestDamagePets:function(e,t,a){let l={},s=JSON.parse(JSON.stringify(e)),n=[],i=[],updateStrongest=e=>{1===e.Type?0===n.length?n.push(e):1===n.length?this.calculatePetBaseDamage(n[0],t)<this.calculatePetBaseDamage(e,t)?(n[1]=n[0],n[0]=e):n[1]=e:this.calculatePetBaseDamage(n[0],t)<this.calculatePetBaseDamage(e,t)?(n[1]=n[0],n[0]=e):this.calculatePetBaseDamage(n[1],t)<this.calculatePetBaseDamage(e,t)&&(n[1]=e):2===e.Type&&(0===i.length?i.push(e):1===i.length?this.calculatePetBaseDamage(i[0],t)<this.calculatePetBaseDamage(e,t)?(i[1]=i[0],i[0]=e):i[1]=e:this.calculatePetBaseDamage(i[0],t)<this.calculatePetBaseDamage(e,t)?(i[1]=i[0],i[0]=e):this.calculatePetBaseDamage(i[1],t)<this.calculatePetBaseDamage(e,t)&&(i[1]=e))},o=[],r={};if(a&&a.requiredPets)for(let e=0;e<a.requiredPets.length;e++)r[a.requiredPets[e].ID]=a.requiredPets[e];for(let e=0;e<s.length;e++){let t=s[e],a=!1;for(let e=0;e<t.BonusList.length;e++){let s=t.BonusList[e];t.ID in r?(l[t.ID]=t,a=!0):1013!==s.ID||l[t.ID]||(l[t.ID]=t,a=!0),1012!==s.ID||l[t.ID]||(l[t.ID]=t,a=!0)}a?updateStrongest(t):o.push(t)}o.sort((e,a)=>this.calculatePetBaseDamage(a,t)-this.calculatePetBaseDamage(e,t));let u=0,m=0;o.map(e=>{1===e.Type&&m++,2===e.Type&&u++});let c=0,h=0,p=0;if(m<2){let e=[];m=0,o.map(t=>{1===t.Type&&(e.push(t),l[t.ID]=t,o=o.filter(e=>e.ID!==t.ID))})}if(u<2){let e=[];u=0,o.map(t=>{2===t.Type&&(e.push(t),l[t.ID]=t,o=o.filter(e=>e.ID!==t.ID))})}for(let e=0;e<o.length;e++){let a=o[e];if(c<2&&1===a.Type||u<=0){if(n.length>0){let e=0;for(;n.length>0&&e<=n.length;){let s=n[e];s&&this.calculatePetBaseDamage(s,t)>=this.calculatePetBaseDamage(a,t)&&(n.splice(e,1),l[a.ID]=a,c++,p++,e--),e++}}(c<2||p<4&&u<=0)&&(l[a.ID]=a,c++,p++,m--)}else if(h<2&&2===a.Type||m<=0){if(i.length>0){let e=0;for(;i.length>0&&e<=i.length;){let s=i[e];s&&this.calculatePetBaseDamage(s,t)>=this.calculatePetBaseDamage(a,t)&&(i.splice(e,1),l[a.ID]=a,h++,p++,e--),e++}}(h<2||p<4&&m<=0)&&(l[a.ID]=a,h++,p++,u--)}if(p>3)break}let g=Object.values(l);return g.sort((e,t)=>t.ID-e.ID),g},calcBestDamageGroup:function(e,t,a,l){a=a||7;let s={},n={},i={};for(let t=0;t<e.length;t++)i[e[t].ID]=JSON.parse(JSON.stringify(e[t]));let o=l?.activeBonuses;o||(o=[]);let memoizedGroupScore=e=>{let a=e.ID;if(!s[a]||s[a]){let l=this.calculateGroupScore(e.team,t),n=l.tokenMult;s[a]={token:n,damage:l.groupScore,other:l}}return s[a]},r={},u={},m={};if(l?.petWhiteList)for(let e=0;e<l.petWhiteList.length;e++){let t=l.petWhiteList[e];"blacklist"===t.placement?r[t.id]=t:"team"===t.placement?u[t.id]=t:"rel"===t.placement&&(m[t.id]=t)}let getCombinationsInner=(e,t,a)=>{let l=-1,s=0,n=0;e.forEach(e=>{1===e.Type?n++:s++});let i=!0;s>1&&n>1&&(i=!1);let o={},r={},u={},m={};for(let e=0;e<a.length;e++){let t=a[e];"team"!==t.placement||(t.parameters.fake?2!==t.pet.Type||u[t.pet.ID]?m[t.pet.ID]||(m[t.pet.ID]=!0):u[t.pet.ID]=!0:(1!==t.pet.Type||r[t.pet.ID])&&r[t.pet.ID]||(r[t.pet.ID]=!0))}let f=(s,n)=>{if(n.length>0){let e=!0,t=0,s=0,c=0,h=0,p=0,g=0;for(let e=0;e<n.length;e++){let t=n[e];1===t.Type?p++:g++,1===t.Type&&m[t.ID]?h++:u[t.ID]&&c++}let D=Object.entries(o).length,d=Object.entries(r).length,I=Object.entries(u).length,b=Object.entries(m).length,M=2>D?2-D:0,P=2>d?2-d:0,_=0;if(I>0){let t=I<M?I:M;c>M?e=!1:c!==t?e=!1:_+=t}if(b>0){let t=b<P?b:P;h>P?e=!1:h!==t?e=!1:_+=t}let E=d>2?d-2:0;if((g>2+(D>2?D-2:0)||p>2+E)&&!i&&(e=!1),e){a.length;for(let l=0;l<a.length;l++){let i=a[l],o=!1;if("team"===i.placement){let a=0;for(let e=0;e<n.length;e++){let l=n[e];l.ID===i.pet.ID&&(i.parameters.fake?t++:(s++,1===l.Type?d++:D++),a++)}if(a>0)o=!0;else if(!i.parameters.fake){e=!1,o=!1;break}}else if(i.requiredNumber>0){let t=0;for(let e=0;e<n.length;e++)n[e].BonusList.find(e=>e.ID===i.bonus.id)&&(t++,s++);if(t>=i.requiredNumber)o=!0;else{e=!1,o=!1;break}}else if(i.exactNumber>-1){let t=0;for(let e=0;e<n.length;e++)n[e].BonusList.find(e=>e.ID===i.bonus.id)&&(t++,s++);if(t===i.exactNumber)o=!0;else{e=!1,o=!1;break}}else if("rel"===i.bonus.placement){let a=0;for(let e=0;e<n.length;e++)n[e].BonusList.find(e=>e.ID===i.bonus.id)&&(a++,t++);if(a<=i.bonus.amount){if(i.tempRequired>0){if(i.bonus.amount<i.tempRequired&&a===i.bonus.amount||a>=i.tempRequired)o=!0;else{e=!1,o=!1;break}}else o=!0}else{e=!1,o=!1;break}}else i.placement;if(i.tempMax||0===i.tempMax&&!i.disabled&&void 0!==i.disabled){let t=0;for(let e=0;e<n.length;e++){let a=n[e];i.pets.find(e=>e.ID===a.ID)&&t++}if(t<=i.tempMax)o=!0;else{e=!1,o=!1;break}}o&&i.passed++}if(_>0&&e&&(_+s>4&&(_=4-s),e=!(t<_)),e){let e="";for(let t=0;t<n.length;t++)e+=n[t].ID,t+1!==n.length&&(e+=",");let t={ID:e,team:n};if(-1===l)l={ID:e,team:n,score:memoizedGroupScore(t)};else{let a=memoizedGroupScore(t);a.damage===l.score.damage?a.token>l.score.token&&(l={ID:e,team:n,score:a}):a.damage>l.score.damage&&(l={ID:e,team:n,score:a})}}}}if(n.length!==t)for(let t=s;t<e.length;t++)f(t+1,[...n,e[t]])};return f(0,[]),l.team&&l.team.sort((e,t)=>e.Type===t.Type?e.ID-t.ID:e.Type-t.Type),l},c=new Date,h=new Date,p=new Date,g=new Date,D=[],d=e.filter(e=>(e.ID in u&&(u[e.ID].pet=e),!(e.ID in r)&&!(e.ID in u)));for(let e=0;e<a;e++){let l=a-e,s=[],p={},g={},I=[];for(let[t,a]of Object.entries(u))if(a.parameters.team===e){if(!i[a.pet.ID])continue;I.push(a),d.push(a.pet),s.push(a.pet)}if(o.length>0){for(let e=0;e<o.length;e++)p[o[e].id]=o[e],g[o[e].id]={bonus:o[e],pets:[],active:!0};d.forEach(e=>{e.ID in r||e.BonusList.forEach(t=>{t.ID in p&&("top"===p[t.ID].placement&&s.push(e),g[t.ID].pets.push(e))})});for(let t=0;t<o.length;t++){let a=g[o[t].id];if("bottom"===a.bonus.placement){let t,n=a.pets.length,i=0,o=!1,r=0;switch(a.bonus.equation){case"min":n<a.bonus.amount?(t=0,o=!0):(n<=l*a.bonus.amount&&(r=a.bonus.amount),t=n%a.bonus.amount,n-=t,i=n>=0?Math.ceil(n/a.bonus.amount):0);break;case"max":break;case"eq":n<a.bonus.amount?(t=0,o=!0):(n<=l*a.bonus.amount&&(r=a.bonus.amount),t=n%a.bonus.amount,n-=t,i=a.pets.length>=a.bonus.amount?Math.ceil(n/a.bonus.amount):0)}if(l<=i)g[a.bonus.id].tempMax=r,a.pets.forEach(e=>{s.push(e)});else{let l=[];for(let t=0;t<g[a.bonus.id].pets.length;t++){let s=g[a.bonus.id].pets[t];s.ID in u&&"team"===u[s.ID].placement&&u[s.ID].parameters.team===e||l.push(s)}g[a.bonus.id].pets=l,g[a.bonus.id].active=!1,g[a.bonus.id].tempMax=t,g[a.bonus.id].disabled=o}}else if("top"===a.bonus.placement){let e=a.pets.length,t=0;e<=l*a.bonus.amount&&(t=a.bonus.amount),g[a.bonus.id].tempMax=t}}for(let e=0;e<o.length;e++){let t=g[o[e].id];if(!t.active)continue;let a=0,l=-1;switch(t.hardFail=!1,t.bonus.equation){case"min":t.bonus.amount>t.pets.length?(a=0,t.hardFail=!0):a=t.bonus.amount;break;case"max":break;case"eq":t.bonus.amount>t.pets.length?(l=-1,t.hardFail=!0):l=t.bonus.amount}t.requiredNumber=a,t.exactNumber=l}}let b=this.getBestDamagePets(d,t,{requiredPets:s});for(let[e,t]of Object.entries(g))t.passed=0;c=new Date;let M=!1,P=!1,_=Object.values(g);for(let e=0;e<I.length;e++)_.push(I[e]);let E=getCombinationsInner(b,Math.min(4,b.length),_);if(h=new Date,console.log(`time to get combinations ${E.length}: ${(h-c)/1e3} seconds`),-1===E&&I.length>0){_=[];for(let e=0;e<I.length;e++)_.push(I[e]);-1===(E=getCombinationsInner(b,Math.min(4,b.length),_))?P=!0:M=!0}for(let[t,a]of(-1===E&&(P=!0),Object.entries(g)))if(!(t in n)&&(!a.passed||a.hardFail)){let l=`Filter failed on group ${e+1}:
`;switch(a.bonus.equation){case"min":l+=`not enough pets, min ${a.bonus.amount} but ${a.pets.length} remain`;break;case"max":break;case"eq":l+=`not enough pets, req. ${a.bonus.amount} but ${a.pets.length} remain`;break;default:throw Error("impossible case")}n[t]=l}if(P){!(Object.values(g).length>0)||"generic"in n||(n.generic=`Individual filters all succeeded, but the combination of all is impossible starting group ${e+1}`);break}if(M){D.push(E.team);for(let e=0;e<E.team.length;e++)E.team[e].ID in m&&delete m[E.team[e].ID];d=d.filter(e=>{let t=!0;for(let a=0;a<E.team.length;a++)if(E.team[a].ID===e.ID){t=!1;break}return t})}else{let a=this.calculateGroupScore(E.team,t),l=a.groupScore,s=Object.values(m);if(o.length>0||s.length>0){let r=!1;for(let n=0;n<s.length;n++){let o=s[n],u=o.parameters.damageBias/100,m=l*u,c=E.team.length,h=0,p=i[o.id],g=this.calculatePetBaseDamage(p,t);if(p&&(p.BonusList.forEach(e=>{let l=0;1013===e.ID?(g*=1+this.EXP_DMG_MOD,c>1?l+=a.baseGroupScore/c*(c-1)*u*this.EXP_DMG_MOD:l=a.baseGroupScore*u*this.EXP_DMG_MOD,h+=l):1012===e.ID&&(g*=1+this.EXP_TIME_MOD,c>1?l+=3*this.calculatePetBaseDamage(p,t)*u*this.EXP_TIME_MOD:l=a.baseGroupScore*u*this.EXP_TIME_MOD,h+=l)}),(g+=h)>m)){r=!0;let t=JSON.parse(JSON.stringify(o));t.placement="team",t.parameters.team=e,t.pet=p,t.parameters.fake=!0,I.push(t),b.find(e=>e.ID===p.ID)||b.push(p)}}for(let e=0;e<o.length;e++){let s=o[e],n=s.relThresh/100,i=l*n,u=!1,m=g[s.id];"rel"!==s.placement||(m.pets.forEach(e=>{let l=this.calculatePetBaseDamage(e,t),s=E.team.length,o=0;e.BonusList.forEach(e=>{let t=0;1013===e.ID?(l*=1+this.EXP_DMG_MOD,s>1?t+=a.baseGroupScore/s*(s-1)*n*this.EXP_DMG_MOD:t=a.baseGroupScore*n*this.EXP_DMG_MOD,o+=t):1012===e.ID&&(l*=1+this.EXP_TIME_MOD,s>1?t+=a.baseGroupScore/s*(s-1)*n*this.EXP_TIME_MOD:t=a.baseGroupScore*n*this.EXP_TIME_MOD,o+=t)}),(l+=o)>i&&(r=!0,u=!0,m.active=!0,m.tempMin=!0,m.tempRequired=0!==m.tempRequired&&m.tempRequired?m.tempRequired+1:1,m.tempRequiredPets||(m.tempRequiredPets=[]),m.tempRequiredPets.push(e),b.find(t=>t.ID===e.ID)||b.push(e))}),u||(m.tempMin=null,m.tempRequired=0,m.tempRequiredPets=[],m.active=!1))}if(r){c=new Date;let t=Object.values(g);for(let e=0;e<I.length;e++)t.push(I[e]);let a=getCombinationsInner(b,Math.min(4,b.length),t);if(console.log("got new combinations after the rel calcs"),-1!==a&&(I=I.filter(e=>!e.parameters.fake||!a.team.find(t=>t.ID===e.id))),-1===a&&0===I.length){"generic"in n||(n.generic=`Individual filters all succeeded, but the combination of all is impossible starting group ${e+1} (too many relative pets in one team)`);break}if(-1!==a){E=a;for(let e=0;e<t.length;e++)t[e].id in m&&a.team.find(a=>a.ID===t[e].id)&&delete m[t[e].id]}}}D.push(E.team);for(let e=0;e<E.team.length;e++)E.team[e].ID in m&&delete m[E.team[e].ID];d=d.filter(e=>{let t=!0;for(let a=0;a<E.team.length;a++)if(E.team[a].ID===e.ID){t=!1;break}return t})}}return g=new Date,console.log(`time to get best combo: ${(g-p)/1e3} seconds`),l?.setFailedFilters&&l.setFailedFilters(n),D},calcBestTokenGroup:function(e,t,a,l){a=a||7;let s=1,n={},memoizedGroupScore=e=>{let a=e.ID;if(!n[a]||n[a]){let l=this.calculateGroupScore(e.team,t),s=l.tokenMult;n[a]={token:s,damage:l.groupScore,other:l}}return n[a]},getCombinationsInner=(e,t,a)=>{let l=-1,f=(n,i)=>{let o=0,r=0,u=[],m=[];a&&(o=a.min?a.min:0,u=a.pets?a.pets:[],m=a.ignoredPets?a.ignoredPets:[]);let c=0;if(i.length>0){let e="";for(let t=0;t<i.length;t++){if(e+=i[t].ID,t+1!==i.length&&(e+=","),o>0)for(let e=0;e<u.length;e++)i[t].ID==u[e].ID&&c++;if(m.length>0)for(let e=0;e<m.length;e++)i[t].ID==m[e].ID&&r++}if(c===o&&0===r){let t={ID:e,team:i};if(-1===l)l={ID:e,team:i,score:memoizedGroupScore(t)};else{let a=memoizedGroupScore(t);1===s?a.damage>l.score.damage&&(l={ID:e,team:i,score:a}):a.token===l.score.token?a.other.tokenRewardCount>0?a.damage<l.score.damage&&(l={ID:e,team:i,score:a}):a.damage>l.score.damage&&(l={ID:e,team:i,score:a}):a.token>l.score.token&&(l={ID:e,team:i,score:a})}}}if(i.length!==t)for(let t=n;t<e.length;t++)f(t+1,[...i,e[t]])};return f(0,[]),l.team&&l.team.sort((e,t)=>e.Type===t.Type?e.ID-t.ID:e.Type-t.Type),l},i=new Date,o=new Date,r=[];for(let n=0;n<a;n++){let i=-1,o=JSON.parse(JSON.stringify(e)),u=0,m=0,c=[],h=0,p=0,g=0;o.forEach(e=>{e.BonusList.forEach(a=>{1016===a.ID&&(c.push(e),m+=this.calculatePetBaseDamage(e,t),u++,1===e.Type?g++:2===e.Type&&p++)})}),m/=u,o=(o=this.getBestDamagePets(o,t,{requiredPets:c})).sort((e,a)=>this.calculatePetBaseDamage(a,t)-this.calculatePetBaseDamage(e,t));for(let e=0;e<2;e++)h+=this.calculatePetBaseDamage(o[e],t);h/=2;let D=this.calcBestDamageGroup(o,t,1)[0];if(h=D?this.calculateGroupScore(D,t):[],u>=4&&p>=2&&g>=2)s=2,i=getCombinationsInner(o,Math.min(4,o.length),{pets:c,min:4}),s=1;else if(1===u)i=n===a-1?getCombinationsInner(o,Math.min(4,o.length),{pets:c,min:c.length}):getCombinationsInner(o,Math.min(4,o.length));else if(u>1){let e=(100-l.tokenDamageBias)/100*h.groupScore;e/=5.75;let t=2;(p>1&&g>0||g>1&&p>0)&&(t=3);let r=Math.ceil(u/t);r>=a-n?(s=r-(a-n)>=0?1:2,i=getCombinationsInner(o,Math.min(4,o.length),{pets:c,min:t}),s=1):m>e?(s=a-n-r>=0?1:2,i=getCombinationsInner(o,Math.min(4,o.length),{pets:c,min:t}),s=1):i=getCombinationsInner(o,Math.min(4,o.length),{pets:[],min:0,ignoredPets:c})}else i=getCombinationsInner(o,Math.min(4,o.length));if(-1===i)break;memoizedGroupScore(i),r.push(i.team),e=e.filter(e=>{let t=!0;for(let a=0;a<i.team.length;a++)if(i.team[a].ID===e.ID){t=!1;break}return t})}return o=new Date,console.log(`time to get best combo: ${(o-i)/1e3} seconds`),r},findBestGroups:function(e,t,a,l,s){switch(a){case 1:case 3:return this.calcBestDamageGroup(e,t,l,s);case 2:return this.calcBestTokenGroup(e,t,l,s)}},calcEquipBonus:function(e,t){let a=1;return 100*(23===t.ID?.5*((Math.pow(1+t.Gain,e.Level)-1+Math.max(0,(.005*l.Z.calculateLogarithm(1.0125,e.Level+1)-1)*.5))*(1+.005*l.Z.calculateLogarithm(1.075,e.Rank+1))):28===t.ID?(Math.pow(1+t.Gain,e.Level)-1+Math.max(0,(.005*l.Z.calculateLogarithm(1.0125,e.Level+1)-1)*.25))*(1+.005*l.Z.calculateLogarithm(1.075,e.Rank+1)):29===t.ID?(Math.pow(1+t.Gain,e.Level)-1+Math.max(0,(.005*l.Z.calculateLogarithm(1.0125,e.Level+1)-1)*.125))*(1+.005*l.Z.calculateLogarithm(1.075,e.Rank+1)):(Math.pow(1+t.Gain,e.Level)-1)*(1+.02*e.Rank))}}},4837:(e,t,a)=>{a.d(t,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var l=a(30784),s=a(9885);a(71183);var n=a(16297),i=a(68068);let __WEBPACK_DEFAULT_EXPORT__=({data:e,onSelect:t,placeholder:a,updateBox:o,margin:r})=>{let[u,m]=(0,s.useState)(null);return l.jsx("div",{style:{width:e?.width?e.width:"288px",minHeight:"0px",height:"36px",margin:r||""},children:l.jsx(n.Z,{options:e.list,renderInput:e=>{let t=e.key;return delete e.key,(0,s.createElement)(i.Z,{...e,key:t,placeholder:u?.label&&o?u.label:a||"Enter a pet"})},ListboxProps:{style:{maxHeight:150}},value:u,clearOnBlur:!0,isOptionEqualToValue:(e,t)=>-1!==t.id&&e.label===t.label,onChange:(e,a)=>{a&&(t(a),o&&m(a))}})})}},71187:(e,t,a)=>{a.d(t,{Z:()=>l});let l={src:"/_next/static/media/x_icon.2c19be28.svg",height:800,width:800,blurWidth:0,blurHeight:0}}};